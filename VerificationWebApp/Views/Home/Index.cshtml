<div class="container">


    <form method="post" id="verifyForm" asp-controller="Customer" asp-action="VerifyID" enctype="multipart/form-data">

        <div class="container mt-5" style="display:flex;justify-content:center;">
            <div class="modal modal-lg" id="myModal" tabindex="-1" style="display:none;">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Snap a Picture</h5>
                            <!--<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
                        </div>
                        <div class="modal-body">
                            <video id="vid" class="form-control" autoplay></video>
                            <canvas id="c" style="display:none;"></canvas>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" id="cancelBtn" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="takeApic">Take a Pic</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <!--<div class="container">-->
        <div class="parent mt-5">
            <div style="display:flex;justify-content:center;align-items:center;position:absolute;">
                <div class="profile-pic-div form-group mt-5" id="picDiv" style="display:flex;justify-content:center;">
                    <img src="~/images/silhouette.jpeg" id="photo" class="imgPhoto img-fluid img-responsive" />
                    <label for="file" id="uploadBtn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">Click to snap a Photo</label>
                </div>
            </div>
        </div>
        <!--</div>-->

        <div class="row form-group">
            <div class="col-100">
                <label for="actNo">Enter Acc Number</label>
            </div>
            <div class="col-100">
                <input type="text" id="actNo" name="customer.actNo" placeholder="Enter your account number here..." class="form-control">
            </div>
        </div>

        <div class="row form-group">
            <div class="col-100">
                <label for="ghCardNo">Ghana Card Number (eg: GHA-xxxxxxxxx-x)</label>
            </div>
            <div class="col-100">
                <input type="text" id="ghCardNo" name="customer.ghCardNo" placeholder="Your Ghana card number goes here..." class="form-control">
            </div>
        </div>

        <div class="row form-group">
            <div class="col-100">
                <label for="TelNo">Telephone Number (eg:024xxxxxxx)</label>
            </div>
            <div class="col-100">
                <input type="text" id="TelNo" name="customer.TelNo" placeholder="Enter telephone number on file..." class="form-control">
            </div>
        </div>

        <div class="row form-group">
            <div class="col-100">
                <label for="motherName">Mother's Maiden Name (eg:Adwoa Kum)</label>
            </div>
            <div class="col-100">
                <input type="text" id="motherName" name="customer.motherName" placeholder="Enter maiden name of your mother..." class="form-control">
            </div>
        </div>

        <br />
        <div class="row form-group">
            <div class="col-md-6 col-100">
                <label>Click on image below to upload front-facing part of National ID</label>
            </div>
            <div class="col-md-6 col-100">
                <label>Click on image below to upload back-facing part of National ID</label>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 front-pic">
                <input type="file" name="fpic" id="fpic" accept="image/*" class="form-control" style="display:none;">
                <img src="~/images/NationalCard-front.jpeg" alt="" id="img-front" class="opacity-25 img-fluid img-responsive">
            </div>
            <div class="col-md-6 back-pic">
                <input type="file" name="bpic" id="bpic" accept="image/*" class="form-control" style="display:none;">
                <img src="~/images/NationalCard-back.jpeg" alt="" id="img-back" class="opacity-25 img-fluid img-responsive">
            </div>
        </div>
        <div class="row form-group">
            <br />
            <input type="text" id="imgData" name="customer.imgData" value="" hidden>
        </div>
        <div class="row form-group">
            <br />
            <input type="text" id="backPicture" name="customer.backPicture" value="" hidden>
        </div>
        <div class="row form-group">
            <br />
            <input type="text" id="frontPicture" name="customer.frontPicture" value="" hidden>
        </div>
        <br />
        <div class="row">
            <br />
            <input type="submit" id="btnSubmit" value="Click to Verify">
        </div>

    </form>

    <div class="loader"></div>

    <script src="~/js/imgPreviewer.js" defer></script>
    <script src="~/js/ghcard.js" defer></script>
    <script>/* Picture taking module */

        const btn = document.getElementById("takeApic");
        const cancelBtn = document.getElementById("cancelBtn");
        const imgData = document.getElementById("imgData");
        const video = document.getElementById("vid");
        const hidden_canvas = document.getElementById("c");
        const photo = document.getElementById("photo");

        const width = 640;
        const height = 480;

        const context = hidden_canvas.getContext("2d");

        const picDiv = document.getElementById("picDiv");
        const submitBtn = document.getElementById("btnSubmit");
        const modal = document.getElementById("myModal");

        const msgDialog = document.getElementById("msgDialog");

        let activeImage;

        /* bind the click event to the img element */

        picDiv.addEventListener("click", (ev) => {
            ev.preventDefault();

            modal.style.display = "block";
        });

        function showMessage(title, msg) {
            myVar = setTimeout(showPage(title, msg), 3000);
        }

        cancelBtn.addEventListener("click", function (e) {
            e.preventDefault();
            modal.style.display = "none";
        })

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }

            if (event.target == msgDialog) {
                msgDialog.style.display = "none";
            }
        }

        var constraints = {
            audio: false,
            video: {
                width: 640,
                height: 480
            }
        }

        navigator.mediaDevices.getUserMedia(constraints).then(stream => {
            video.srcObject = stream;
            video.play();  /*playing the video*/
        }).catch(function (err) {


        })

        function takeSnapShot() {

            //setting the dimensions of the hidden canvas to the video element
            hidden_canvas.width = width;
            hidden_canvas.height = height;

            context.drawImage(video, 0, 0, width, height);

            /* get an image dataURL from the canvas */
            const imageDataUrl = hidden_canvas.toDataURL("image/png");

            imgData.setAttribute("value", imageDataUrl);

            photo.setAttribute("src", imageDataUrl);
        }

        /* event binding */
        btn.addEventListener("click", () => {
            takeSnapShot();
            cancelBtn.click();
        });</script>

    <script type="text/javascript">
        $(document).ready(function () {

            $body = $("body");

            $(document).on({
                ajaxStart: function () { $body.addClass("loading"); },
                ajaxStop: function () { $body.removeClass("loading"); }
            });

            function handleResponse(res) {

                console.log(res);

                if (res.status.toString() == "true") {
                    alert(res.data.toString());
                }
                else {
                    alert(res.data.toString());
                }
            }

            function handleError(err) {

                if (xhr.responseText)
                    showErrorMessage(xhr.responseText);
                else
                    showErrorMessage("Error has occured. Please try again later.");

            }

            function showErrorMessage(message) {
                /* show a popup logic or an alert logic */
                var popup = $('#errorAlert');
                popup.removeClass('d-none');
                $('body').removeClass('loading');

                setTimeout(() => {
                    popup.addClass('d-none');
                }, 5000);
            }

            /* submit event click */

            $('#verifyForm').on('submit', function (e) {
                e.preventDefault();

                var f = $(e.currentTarget);

                var form = $('#verifyForm')[0];
                var dt = new FormData(form);
                dt.append("imgData", imgData);
                dt.append("frontPicture", document.getElementById("frontPicture").getAttribute("value"));
                dt.append("backPicture", document.getElementById("backPicture").getAttribute("value"));

                $.ajax({
                    type: 'POST',
                    url: f.attr('action'),
                    data: dt,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: handleResponse,
                    error: handleError

                });

            });


        });</script>


</div>